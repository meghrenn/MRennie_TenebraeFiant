<!DOCTYPE html>
<html lang="en-CAN">

<head>
    <title>Dig Deeper...</title>
    <link rel="icon" type="image/png" href="../images/logo/favicon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/history-hold.css">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"></script>
    <script src="../js/scripts.js"></script>
</head>
<style>
    * {
        z-index: 3;
    }

    .locked {
        filter: brightness(0.1);
        opacity: 0.8;
    }

    .avail {
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        animation: glow-animation 1s infinite alternate;
    }

    .seen {
        box-shadow: none !important;
        animation: none !important;
    }

    #dark-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #000000;
        opacity: 0;
        pointer-events: none;
        transition: opacity 1.5s ease;
        z-index: 9999;
    }

    #dark-overlay.show {
        opacity: 1;
        transition: opacity 0s ease-in;
    }

    #origin-text {
        transition: opacity 0.5s ease;
        /* opacity: 0; */
    }

    #origin-text>* {
        transition: opacity 1s ease;
        z-index: 1000;
        position: relative;
    }

    /* #origin-text.visible {
        opacity: 1;
    } */
</style>

<body id="hist-grid" data-group-id="beginning" data-page-id="origins">
    <header id="main-header">
        <ul>
            <li id="about" class="basic-padding">About</li>
            <li id="help" class="basic-padding">Trouble</li>
            <li id="progress" class="basic-padding">Progress</li>
        </ul>
    </header>
    <div id="hist-hold">
        <div id="origin-text" class="thick-padding containment">
            <h1>Origins</h1>
            <p class>I can feel another vision coming on. Noâ€”not one vision, but many.</p>
            <p class="tangent">(A whirlwind of imagery, a twister of historical particulate.)</p>
            <p>They feel like memories, real scenes that played out. How far back can I see?
                How deep does this go?</p>
        </div>
        <img id="above" class="locked" src="../images/overhead/1956.jpg">
        <img id="fog" class="avail" src="../images/origins/bldg-plan1.png">
        <img id="controversy" class="locked" src="../images/origins/protest1.png">
        <img id="ameliorate" class="avail" src="../images/meliorist/first-edition.jpg">
        <img id="puzzle" class="locked" src="../images/bug/vw-bug1.png">
        <img id="west" class="avail" src="../images/origins/bldg1.png">
        <img id="logo" class="locked" src="../images/coat-of-arms.jpg">
        <img id="construction" class="avail" src="../images/origins/1971.png">
        <img id="unearthed" class="locked" src="../images/meliorist/unearthed-photograph.jpg">
        <img id="tale" class="locked" src="../images/students1.png">

        <!-- WE WOULD IF WE COULD -->

        <img id="worm" class="avail" src="../images/origins/worm3.png">
    </div>
    <div id="dark-overlay"></div>
    <div id="header-container"></div>
</body>
<script>
    const histHold = document.getElementById('hist-hold');
    var audio = new Audio('../audio/page-move2.wav');
    audio.volume = 0.7;
    audio.playbackRate = 2;
    histHold.addEventListener('mouseover', function (event) {
        if (event.target.closest('#hist-hold')) {
            audio.play();
        }
    });

    window.onload = function () {
        function handleClick(event, url) {
            if (event.target.classList.contains('locked')) {
                event.preventDefault();
            } else {
                window.location.href = url;
            }
        }

        document.getElementById("worm").addEventListener("click", function (event) {
            handleClick(event, "../tunnel/worm.html");
        });
        document.getElementById("fog").addEventListener("click", function (event) {
            handleClick(event, "../architect/fog.html");
        });
        // document.getElementById("strike1").addEventListener("click", function (event) {
        //     handleClick(event, "../strike/2022.html");
        // });
        // document.getElementById("strike2").addEventListener("click", function (event) {
        //     handleClick(event, "../strike/2022.html");
        // });
        document.getElementById("ameliorate").addEventListener("click", function (event) {
            handleClick(event, "../meliorist/ameliorate.html");
        });
        document.getElementById("logo").addEventListener("click", function (event) {
            handleClick(event, "../monster/logo.html");
        });
        document.getElementById("tale").addEventListener("click", function (event) {
            handleClick(event, "../tale/goodbye.html");
        });
        document.getElementById("west").addEventListener("click", function (event) {
            handleClick(event, "../place/west.html");
        });
        document.getElementById("above").addEventListener("click", function (event) {
            handleClick(event, "../place/above.html");
        });
        document.getElementById("puzzle").addEventListener("click", function (event) {
            handleClick(event, "../puzzling/puzzle.html");
        });
        document.getElementById("unearthed").addEventListener("click", function (event) {
            handleClick(event, "../meliorist/unearthed.html");
        });
        document.getElementById("construction").addEventListener("click", function (event) {
            handleClick(event, "../puzzling/construction.html");
        });
    };


    document.addEventListener('DOMContentLoaded', function () {
        const gameProgress = JSON.parse(localStorage.getItem('gameProgress')) || []; // Retrieve gameProgress from local storage
        let histHoldChildren = document.querySelectorAll('#hist-hold > *');
        let endAvail = false;

        // Iterate through each child element
        histHoldChildren.forEach(function (child) {
            let childId = child.id;

            // Check if the ID matches any pageId or groupId in the array
            let matchFound = gameProgress.some(function (item) {
                return item.pageId === childId || item.groupId === childId;
            });

            if (matchFound) {
                child.classList.add('seen');
                child.classList.remove('locked');
                child.classList.remove('avail');
            }
        });

        // Check if all specified groupIds are present in gameProgress
        const requiredGroupIds = ['beginning'];
        const allRequiredIdsPresent = requiredGroupIds.every(groupId =>
            gameProgress.some(item => item.groupId === groupId)
        );

        if (allRequiredIdsPresent) {
            document.getElementById('origin-text').style.opacity = '0';
            document.getElementById('dark-overlay').classList.add('show');

            setTimeout(() => {
                document.getElementById('origin-text').innerHTML = `
            <h1>Origins</h1>
            <p>Something emerges from the depths....</p>
            <p>A final vision, drawing close.</p>
            <div class="center-container basic-padding marginal-margin">
                <div id="end" class="button basic-padding">start the end</div>
            </div>`;

                endAvail = true;
                setTimeout(() => {
                    document.getElementById('dark-overlay').classList.remove('show');
                }, 1000);

                document.getElementById('origin-text').style.opacity = '1';
                const children = document.getElementById('origin-text').children;
                function fadeInElements(index = 0) {
                    if (index < children.length) {
                        children[index].style.opacity = '1';
                        setTimeout(() => {
                            fadeInElements(index + 1);
                        }, 1500);
                    }
                }

                // Initialize opacity to 0 for all children
                for (let i = 0; i < children.length; i++) {
                    children[i].style.opacity = '0';
                }
                fadeInElements();

            }, 500); // Adjust delay to control how long the fade-out lasts
        }

        console.log("5678");

        // Use a mutation observer to detect changes to the 'end' element
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.addedNodes.length > 0) {
                    const endElement = document.getElementById("end");
                    if (endElement) {
                        endElement.addEventListener("click", function () {
                            console.log("VBN");
                            document.body.style.backgroundColor = 'var(--green-dark)';

                            document.getElementById("main-header").style.backgroundColor = 'var(--green-medium)';
                            setTimeout(function () {
                                document.body.style.backgroundColor = '';
                                document.getElementById("main-header").style.backgroundColor = '';
                                window.location.href = "../ending/encroaching-end.html";
                            }, 700);

                        });
                        observer.disconnect(); // Stop observing after the event listener is added
                    }
                }
            });
        });

        // Observe changes to the #origin-text element
        observer.observe(document.getElementById('origin-text'), { childList: true });
    });


    // document.addEventListener('DOMContentLoaded', function () {
    //     const gameProgress = JSON.parse(localStorage.getItem('gameProgress')) || []; // Retrieve gameProgress from local storage
    //     let histHoldChildren = document.querySelectorAll('#hist-hold > *');
    //     let endAvail = false;
    //     // Iterate through each child element
    //     histHoldChildren.forEach(function (child) {
    //         let childId = child.id;

    //         // Check if the ID matches any pageId or groupId in the array
    //         let matchFound = gameProgress.some(function (item) {
    //             return item.pageId === childId || item.groupId === childId;
    //         });

    //         if (matchFound) {
    //             child.classList.add('seen');
    //             child.classList.remove('locked');
    //             child.classList.remove('avail');
    //         }
    //     });


    //     // Check if all specified groupIds are present in gameProgress
    //     const requiredGroupIds = ['beginning',
    //         // 'architect', 'place', 'puzzling', 'tunnel'
    //     ];
    //     const allRequiredIdsPresent = requiredGroupIds.every(groupId =>
    //         gameProgress.some(item => item.groupId === groupId)
    //     );
    //     if (allRequiredIdsPresent) {
    //         document.getElementById('origin-text').style.opacity = '0';
    //         document.getElementById('dark-overlay').classList.add('show');
    //         setTimeout(() => {
    //             document.getElementById('origin-text').innerHTML = `
    //             <h1>Origins</h1>
    //             <p>Something emerges from the depths....</p>
    //             <p>A final vision, drawing close.</p>
    //             <div class="center-container basic-padding marginal-margin">
    //                 <div id="end" class="button basic-padding">start the end</div>
    //             </div>`;
    //             endAvail = true;
    //             setTimeout(() => {
    //                 document.getElementById('dark-overlay').classList.remove('show');
    //             }, 1000);

    //             document.getElementById('origin-text').style.opacity = '1';
    //             const children = document.getElementById('origin-text').children;
    //             function fadeInElements(index = 0) {
    //                 if (index < children.length) {
    //                     children[index].style.opacity = '1';
    //                     setTimeout(() => {
    //                         fadeInElements(index + 1);
    //                     }, 1500);
    //                 }
    //             }

    //             // Initialize opacity to 0 for all children
    //             for (let i = 0; i < children.length; i++) {
    //                 children[i].style.opacity = '0';
    //             }
    //             fadeInElements();

    //         }, 500); // Adjust delay to control how long the fade-out lasts
    //     }
    //     console.log("5678");
    //     if (endAvail) {
    //         console.log("tyu");
    //         document.getElementById("end").addEventListener("click", function () {
    //             console.log("VBN");
    //             document.body.style.backgroundColor = 'var(--green-dark)';

    //             document.getElementById("main-header").style.backgroundColor = 'var(--green-medium)';
    //             setTimeout(function () {
    //                 document.body.style.backgroundColor = '';
    //                 document.getElementById("main-header").style.backgroundColor = ')';
    //                 window.location.href = "../ending/encroaching-end.html";
    //             }, 700);

    //         });
    //     }
    // });

    const choseTail = localStorage.getItem('choseTail') === 'true';

    if (choseTail) {
        document.getElementById('tale').classList.add('avail');
        document.getElementById('tale').classList.remove('locked');
    } else {
        document.getElementById('tale').classList.add('locked');
        document.getElementById('tale').classList.remove('avail');
    }



    window.addEventListener('scroll', function () {
        const scrollTop = window.scrollY;
        const windowHeight = window.innerHeight;
        const pageHeight = histHold.offsetHeight;
        const opacity = 0 + (scrollTop / (pageHeight - windowHeight));

        let darkeningElement = document.querySelector('.darken');
        if (!darkeningElement) {
            darkeningElement = document.createElement('div');
            darkeningElement.classList.add('darken');
            document.body.appendChild(darkeningElement);
        }

        darkeningElement.style.opacity = opacity;
    });
</script>

</html>